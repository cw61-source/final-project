<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Manager</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
      padding: 30px 20px;
    }

    h1 {
      text-align: center;
      color: #1a1a2e;
      margin-bottom: 6px;
      font-size: 2rem;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 0.9rem;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    /* stats bar */
    .stats {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      background: white;
      border-radius: 10px;
      padding: 14px 18px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      min-width: 120px;
    }

    .stat-card .num {
      font-size: 1.8rem;
      font-weight: 700;
      color: #4f46e5;
    }

    .stat-card .label {
      font-size: 0.75rem;
      color: #888;
      margin-top: 2px;
    }

    /* form */
    .add-form {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }

    .add-form h2 {
      font-size: 1rem;
      color: #333;
      margin-bottom: 14px;
    }

    .form-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px 14px;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      font-size: 0.9rem;
      outline: none;
      min-width: 140px;
    }

    input[type="text"]:focus {
      border-color: #4f46e5;
    }

    button {
      padding: 10px 20px;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    button:hover { background: #3730a3; }

    button.danger {
      background: #ef4444;
    }

    button.danger:hover { background: #b91c1c; }

    /* filter tabs */
    .filters {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .filter-btn {
      background: white;
      color: #555;
      border: 1.5px solid #ddd;
      border-radius: 20px;
      padding: 6px 16px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .filter-btn.active {
      background: #4f46e5;
      color: white;
      border-color: #4f46e5;
    }

    /* task list */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .task-card {
      background: white;
      border-radius: 10px;
      padding: 14px 18px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: opacity 0.2s;
    }

    .task-card.done .task-title {
      text-decoration: line-through;
      color: #aaa;
    }

    .check-btn {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 2px solid #4f46e5;
      background: white;
      cursor: pointer;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: white;
      padding: 0;
      transition: background 0.2s;
    }

    .check-btn.checked {
      background: #4f46e5;
    }

    .task-info {
      flex: 1;
    }

    .task-title {
      font-weight: 600;
      color: #1a1a2e;
      font-size: 0.95rem;
    }

    .task-desc {
      font-size: 0.8rem;
      color: #888;
      margin-top: 2px;
    }

    .task-id {
      font-size: 0.7rem;
      color: #ccc;
    }

    .del-btn {
      background: none;
      border: none;
      color: #ccc;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 4px 8px;
      border-radius: 6px;
      transition: color 0.2s, background 0.2s;
    }

    .del-btn:hover {
      color: #ef4444;
      background: #fef2f2;
    }

    .empty-msg {
      text-align: center;
      color: #aaa;
      padding: 40px 0;
      font-size: 0.95rem;
    }

    .bottom-bar {
      margin-top: 20px;
      text-align: right;
    }

    @media (max-width: 500px) {
      h1 { font-size: 1.5rem; }
      .form-row { flex-direction: column; }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üìù Task Manager</h1>
  <p class="subtitle">My FastAPI final project</p>

  <!-- stats -->
  <div class="stats">
    <div class="stat-card">
      <div class="num" id="stat-total">0</div>
      <div class="label">Total Tasks</div>
    </div>
    <div class="stat-card">
      <div class="num" id="stat-done">0</div>
      <div class="label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="num" id="stat-pending">0</div>
      <div class="label">Pending</div>
    </div>
    <div class="stat-card">
      <div class="num" id="stat-pct">0%</div>
      <div class="label">Done %</div>
    </div>
  </div>

  <!-- add task -->
  <div class="add-form">
    <h2>Add a new task</h2>
    <div class="form-row">
      <input type="text" id="inp-title" placeholder="Task title *" />
      <input type="text" id="inp-desc" placeholder="Description (optional)" />
      <button onclick="addTask()">Add Task</button>
    </div>
  </div>

  <!-- filters -->
  <div class="filters">
    <button class="filter-btn active" onclick="setFilter(null, this)">All</button>
    <button class="filter-btn" onclick="setFilter(false, this)">Pending</button>
    <button class="filter-btn" onclick="setFilter(true, this)">Completed</button>
  </div>

  <!-- task list -->
  <div class="task-list" id="task-list"></div>

  <div class="bottom-bar">
    <button class="danger" onclick="deleteAll()">üóë Delete All Tasks</button>
  </div>
</div>

<script>
  const API = "";  // same origin
  let currentFilter = null;

  async function loadTasks() {
    let url = API + "/tasks";
    if (currentFilter !== null) {
      url += "?completed=" + currentFilter;
    }
    const res = await fetch(url);
    const tasks = await res.json();
    renderTasks(tasks);
    loadStats();
  }

  async function loadStats() {
    const res = await fetch(API + "/tasks/stats");
    const data = await res.json();
    document.getElementById("stat-total").textContent = data.total;
    document.getElementById("stat-done").textContent = data.completed;
    document.getElementById("stat-pending").textContent = data.pending;
    document.getElementById("stat-pct").textContent = data.completion_percentage + "%";
  }

  function renderTasks(tasks) {
    const container = document.getElementById("task-list");
    container.innerHTML = "";

    if (tasks.length === 0) {
      container.innerHTML = '<div class="empty-msg">No tasks here yet üôÇ</div>';
      return;
    }

    tasks.forEach(task => {
      const card = document.createElement("div");
      card.className = "task-card" + (task.completed ? " done" : "");
      card.innerHTML = `
        <button class="check-btn ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id}, ${task.completed})">
          ${task.completed ? "‚úì" : ""}
        </button>
        <div class="task-info">
          <div class="task-title">${escapeHtml(task.title)}</div>
          ${task.description ? `<div class="task-desc">${escapeHtml(task.description)}</div>` : ""}
          <div class="task-id">#${task.id}</div>
        </div>
        <button class="del-btn" onclick="deleteTask(${task.id})" title="Delete">‚úï</button>
      `;
      container.appendChild(card);
    });
  }

  async function addTask() {
    const title = document.getElementById("inp-title").value.trim();
    const desc = document.getElementById("inp-desc").value.trim();

    if (!title) {
      alert("Please enter a task title!");
      return;
    }

    await fetch(API + "/tasks", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, description: desc || null })
    });

    document.getElementById("inp-title").value = "";
    document.getElementById("inp-desc").value = "";
    loadTasks();
  }

  async function toggleTask(id, currentStatus) {
    await fetch(API + "/tasks/" + id, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ completed: !currentStatus })
    });
    loadTasks();
  }

  async function deleteTask(id) {
    if (!confirm("Delete this task?")) return;
    await fetch(API + "/tasks/" + id, { method: "DELETE" });
    loadTasks();
  }

  async function deleteAll() {
    if (!confirm("Delete ALL tasks? This cannot be undone!")) return;
    await fetch(API + "/tasks", { method: "DELETE" });
    loadTasks();
  }

  function setFilter(val, btn) {
    currentFilter = val;
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    loadTasks();
  }

  function escapeHtml(str) {
    const div = document.createElement("div");
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
  }

  // enter key to add task
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("inp-title").addEventListener("keydown", e => {
      if (e.key === "Enter") addTask();
    });
    loadTasks();
  });
</script>

</body>
</html>
